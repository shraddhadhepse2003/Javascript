(()=>{var e={279:e=>{let t={MODE:"development",API_URL:"http://localhost:3010/",WEBSOCKET_URL:"ws://localhost:3010/",CDN_URL:"http://localhost:3010/",JS_PATH:"js/"};t={MODE:"production",API_URL:"https://acdn.browsee.io/",WEBSOCKET_URL:"wss://session.browsee.io/",CDN_URL:"https://cdn.browsee.io/",JS_PATH:"js/"},e.exports=t}},t={};function s(r){var i=t[r];if(void 0!==i)return i.exports;var n=t[r]={exports:{}};return e[r](n,n.exports,s),n.exports}(()=>{"use strict";var e={RecordingStates:{NONE:0,ALL:1,NO_DOM:2,NO_ERROR:3}};const t=(...e)=>{0};var r={EventTypes:{NETWORK_CALL:1,EVENT:2,URL:3,IDENTIFY:4,MOUSE:5,PAGE_LOAD:6,COMPONENTS:7,CUSTOM_EVENT:8,CLICK_EVENT:9},ComponentAnalyticsTypes:{VIEW:1,TIME:2,CLICK:3},BrowseeUrlParams:{RECORD:"brRecord",TEST_INSTALLATION:"brTestInstall"},s4:()=>Math.floor(65536*(1+Math.random())).toString(16).substring(1),generate12DigitString:()=>Math.random().toString().slice(2,14),generate12CharacterString:()=>r.s4()+r.s4()+r.s4(),guid:()=>r.s4()+r.s4()+"-"+r.s4()+"-"+r.s4()+"-"+r.s4()+"-"+r.s4()+r.s4()+r.s4(),objectEquals:(e,t)=>{if(null==e||null==t)return e===t;if(e.constructor!==t.constructor)return!1;if(e instanceof Function)return e===t;if(e instanceof RegExp)return e===t;if(e===t||e.valueOf()===t.valueOf())return!0;if(Array.isArray(e)&&e.length!==t.length)return!1;if(e instanceof Date)return!1;if(!(e instanceof Object))return!1;if(!(t instanceof Object))return!1;var s=Object.keys(e);return Object.keys(t).every((function(e){return-1!==s.indexOf(e)}))&&s.every((function(s){return r.objectEquals(e[s],t[s])}))},getPercentScroll:e=>{var t=document.body.scrollHeight,s=window.scrollY;void 0!==e&&(s=e);var r=window.innerHeight+s;return Math.round(100*r/t)},isDnt:()=>!!(window.doNotTrack||navigator.doNotTrack||navigator.msDoNotTrack)&&!!("1"==window.doNotTrack||"yes"==navigator.doNotTrack||"1"==navigator.doNotTrack||"1"==navigator.msDoNotTrack||"msTrackingProtectionEnabled"in window.external&&window.external.msTrackingProtectionEnabled()),testInstallation:e=>{const t=e=>`color: ${e}; font-weight: bold;`;console.log("%c Browsee integrated successfully!",t("green")),r.isDnt()&&console.log("%c Do Not Track detected!",t("red")),e&&(console.log("%c Current Session",t("green")),console.log(e))},isASCII:e=>/^[\x00-\x7F]*$/.test(e),getRootDomain:()=>{if(location.rootDomain)return location.rootDomain;var e=location.hostname.split(".").slice(-2).join(".");return location.rootDomain=e,e},getCookie:e=>{var t=document.cookie.match("(^|;)\\s*"+e+"\\s*=\\s*([^;]+)");return t&&t.length?t.pop():null}};class i{constructor(){this.options={selectors:["tag","id","class","nthchild"]},this.__indexOf=[].indexOf||function(e){for(var t=0,s=this.length;t<s;t++)if(t in this&&this[t]===e)return t;return-1}}isElement(e){return!(1!==(null!=e?e.nodeType:void 0))}getParents(e){var t,s;if(s=[],this.isElement(e))for(t=e;this.isElement(t);)s.push(t),t=t.parentNode;return s}getTagSelector(e){return e.tagName.toLowerCase()}sanitizeItem(e){return escape(e).replace(/\%/g,"\\")}validateId(e){return null!=e&&(!/^\d/.exec(e)&&1===document.querySelectorAll("#"+e).length)}getIdSelector(e){var t;return null!=(t=e.getAttribute("id"))&&(t=this.sanitizeItem(t)),t=t=this.validateId(t)?"#"+t:null}getClassSelectors(e){var t,s,r;return r=[],null!=(t=e.getAttribute("class"))&&""!==(t=(t=t.replace(/\s+/g," ")).replace(/^\s|\s$/g,""))&&(r=function(){var e,r,i,n;for(n=[],e=0,r=(i=t.split(/\s+/)).length;e<r;e++)s=i[e],n.push("."+this.sanitizeItem(s));return n}.call(this)),r}getAttributeSelectors(e){var t,s,r,i,n,o,a;for(r=[],s=["id","class"],i=0,n=(o=e.attributes).length;i<n;i++)a=(t=o[i]).nodeName,this.__indexOf.call(s,a)<0&&r.push("["+t.nodeName+"="+t.nodeValue+"]");return r}getNthChildSelector(e){var t,s,r,i,n,o;if(null!=(s=e.parentNode))for(t=0,n=0,o=(i=s.childNodes).length;n<o;n++)if(r=i[n],this.isElement(r)&&(t++,r===e))return":nth-child("+t+")";return null}testSelector(e,t){var s,r;return s=!1,null!=t&&""!==t&&1===(r=e.ownerDocument.querySelectorAll(t)).length&&r[0]===e&&(s=!0),s}getAllSelectors(e){var t;return t={t:null,i:null,c:null,a:null,n:null},this.__indexOf.call(this.options.selectors,"tag")>=0&&(t.t=this.getTagSelector(e)),this.__indexOf.call(this.options.selectors,"id")>=0&&(t.i=this.getIdSelector(e)),this.__indexOf.call(this.options.selectors,"class")>=0&&(t.c=this.getClassSelectors(e)),this.__indexOf.call(this.options.selectors,"attribute")>=0&&(t.a=this.getAttributeSelector(e)),this.__indexOf.call(this.options.selectors,"nthchild")>=0&&(t.n=this.getNthChildSelector(e)),t}testUniqueness(e,t){var s;return 1===(s=e.parentNode.querySelectorAll(t)).length&&s[0]===e}getUniqueSelector(e){var t,s,r;if(null!=(r=this.getAllSelectors(e)).i)return r.i;if(this.testUniqueness(e,r.t))return r.t;if(0!==r.c.length){if(s=t=r.c.join(""),this.testUniqueness(e,s))return s;if(s=r.t+t,this.testUniqueness(e,s))return s}return r.n}getSelector(e){var t,s,r,i,n,o,a,c,d,l;for(t=[],a=0,d=(r=this.getParents(e)).length;a<d;a++)s=r[a],null!=(n=this.getUniqueSelector(s))&&t.push(n);for(o=[],c=0,l=t.length;c<l;c++)if(s=t[c],o.unshift(s),i=o.join(" > "),this.testSelector(e,i))return i;return null}targetProperties(e){var t={nodeName:e.nodeName.toLowerCase()};if(e.id&&(t.domId=e.id),e.name&&(t.name=e.name),e.textContent){var s=e.textContent.replace(/^\s+/,"").replace(/\s+$/,"");s.length>200&&(s=s.substring(0,200)+"..."),t.text=s}try{t.cssSelector=this.getSelector(e)}catch(e){t.cssSelector=""}const r=["alt","src","value","type","action","onclick","href","target"],i=["password","email","phone"];if(e.attributes){for(var n=e.attributes,o=0;o<n.length;o++){var a=n[o];-1!==r.indexOf(a.name)&&(t.attributes||(t.attributes={}),t.attributes[a.name]=a.value)}t.attributes&&-1!=i.indexOf(t.attributes.type)&&delete t.attributes.value}return t}}const n=["input","textarea","select","option"],o=["input","textarea","select","option","pre","code","canvas"],a=["button","a"],c={attributes:!0,childList:!0,subtree:!0},d=1,l=2,h=3,u=4,g=(e,t)=>{const s=e.x-t.x,r=e.y-t.y;return s*s+r*r};class p{constructor(e){this.clickSequence=[],this.clickChanges={},this.selectorGenerator=new i,this.lastNetworkCallTime=(new Date).getTime(),this.lastMutationTime=(new Date).getTime(),this.sendClickData=e}triggerClickData(e,t,s,r){var i=t.event,n=this.selectorGenerator.targetProperties(i.target),o=i.target.getBoundingClientRect(),a=Math.round(100*(i.clientX-o.left)/o.width),c=Math.round(100*(i.clientY-o.top)/o.height);this.sendClickData(e,{x:t.x,y:t.y,percentX:a,percentY:c,scrollX:t.scrollX,scrollY:t.scrollY},n,s,t.time)}triggerRageClick(e,s){t((e.event.pageX,e.event.pageY)),this.triggerClickData(d,e,s)}triggerDeadClick(e,s){t((e.event.pageX,e.event.pageY)),this.triggerClickData(l,e,s)}setObserver(){var e=window.document.getElementsByTagName("body")[0];if(!this.observer){var t=this;this.observer=new MutationObserver((function(e){t.updateMutation(e)})),this.observer.observe(e,c)}}disconnectObserver(){this.observer&&(this.observer.disconnect(),this.observer=null)}updateClick(e,s,r){var i=document.location.pathname,n=Math.floor(99999999*Math.random()+1);const o=e.event.target.tagName.toLowerCase();if(!this.shouldIgnoreForRageClick(o)){this.clickSequence.push({x:e.x,y:e.y}),this.checkSequenceProximity()&&(t(),this.triggerRageClick(e,i),this.resetClickTimers()),this.rageClickTimer&&window.clearTimeout(this.rageClickTimer);var a=this;this.rageClickTimer=window.setTimeout((function(){a.resetClickTimers()}),1500)}if(this.isActionableTarget(o))r(u);else{var c=l;this.isCTATarget(o)&&(t(),c=h),this.currentClick=n,this.setObserver();var d=(new Date).getTime();a=this;window.setTimeout((function(){var t=document.location.pathname;if(i==t&&a&&d>a.lastNetworkCallTime&&d>a.lastMutationTime&&c!=h)a.triggerDeadClick(e,i),r(l,{});else{var s=a.clickChanges[n];s||(s={}),i!==t&&(s.url=t),r(h,s),delete a.clickChanges[n]}a.currentClick==n&&(a.currentClick=null),a.disconnectObserver()}),1e3)}}updateNetworkCall(e){this.currentClick&&(this.clickChanges[this.currentClick]||(this.clickChanges[this.currentClick]={}),this.clickChanges[this.currentClick].calls||(this.clickChanges[this.currentClick].calls=[]),this.clickChanges[this.currentClick].calls.push(e)),this.lastNetworkCallTime=(new Date).getTime()}updateMutation(e){var t=0;e.forEach((function(e){e.addedNodes&&1==e.addedNodes.length&&"html2canvas-container"==e.addedNodes[0].className||e.removedNodes&&1==e.removedNodes.length&&"html2canvas-container"==e.removedNodes[0].className||t++})),t>0&&(this.currentClick&&(this.clickChanges[this.currentClick]||(this.clickChanges[this.currentClick]={}),this.clickChanges[this.currentClick].mutations=!0),this.lastMutationTime=(new Date).getTime())}resetClickTimers(){this.clickSequence=[]}isActionableTarget(e){return-1!=n.indexOf(e)}isCTATarget(e){return-1!=a.indexOf(e)}shouldIgnoreForRageClick(e){return-1!=o.indexOf(e)}checkSequenceProximity(){if(this.clickSequence.length<4)return!1;for(var e=JSON.parse(JSON.stringify(this.clickSequence)),t=0;t<e.length;t++){const s=0==t?e.length-1:t-1;if(g(e[s],e[t])>1e4)return!1}return!0}}var v={handlers:{password:function(e){return"p*s*w*r*d"},email:function(e){return"*****@*****"},tel:function(e){return"**********"},text:function(e){return"*****"},replace:function(e){return e.replace(/\S/g,".")}},tags:["input","textarea","select","datalist","option","output"],stopTypes:["password"],privateTypes:["email","tel"],inputTypes:["text","number","email","tel"],ignoreAttrs:["class","title","id"],fieldNames:["name","fullname","firstname","lastname","familyname","surname","address","address1","address2","addressline1","addressline2","cell","cellphone","mobile","phone","tel","telephone","dateofbirth","dob","birthdate","zip","zipcode","postalcode","email","username","nin","ppsn","security","securitynum","socialsec","socialsecuritynumber","socsec","ssn","adgangskode","authpw","contrasena","cc","cccsc","cccvc","cccvv","ccexp","ccexpiry","ccexpmonth","ccexpyear","ccname","ccnum","ccnumber","cctype","creditcard","csc","cvc","cvv","exp","accountnum","accountnumber","bic","iban","ibanaccountnum","ibanaccountnumber","pin","pinno","pinnum","secq","secret","secretq","secretquestion","securityq","securityquestion","sortcode","swift"],privacyType:{PRIVATE_INPUT_FIELDS:1,INPUT_FIELDS:2,PRIVATE_FIELDS_IN_PAGE:3,NO_TEXT:4}};class m{constructor(e){this.prefs=e,document&&(this.excludedList=document.querySelectorAll("[data-br-exclude]"))}shouldReplaceInputField(e,t,s){return!(!this.prefs.pr||!this.prefs.pr.length)||(!(!e||"password"!=e)||!!(e&&-1!=v.inputTypes.indexOf(e)||t&&-1!=v.fieldNames.indexOf(t)||t&&-1!=t.indexOf("password")||s&&-1!=v.fieldNames.indexOf(s)))}shouldObfuscateNode(e){return!(!e||-1==v.tags.indexOf(e.tagName.toLowerCase()))}hasExcludeAttribute(e){return!!(e&&e.hasAttribute&&e.hasAttribute("data-br-exclude"))}isExcluded(e){if(this.hasExcludeAttribute(e))return!0;if(this.excludedList)for(var t=0;t<this.excludedList.length;t++)if(this.excludedList[t].contains(e))return!0;return!1}maybeSensitive(e){return null!=e&&(-1!==e.indexOf("@")||/\d/.test(e))}obfuscatePrivateText(e){return this.maybeSensitive(e)?e.replace(/[0-9]/g,"X").replace(/([a-zA-Z0-9._-]+@[a-zA-Z0-9._-]+\.[a-zA-Z0-9._-]+)/gi,"***@***").replace(/([a-zA-Z0-9._-]+@)/gi,"***@"):e}getObfuscatedValue(e){var t=e.value;if(this.isExcluded(e))return v.handlers.replace(t);var s=e.type?e.type.toLowerCase():void 0,r=e.name?e.name.toLowerCase():void 0,i=e.id?e.id.toLowerCase():void 0;e.tagName.toLowerCase();return this.shouldReplaceInputField(s,r,i)?this.obfuscateAttributeValue(s,t):t}handleAttributeObfuscation(e,t,s,r){if("value"==t){if(r)return v.handlers.replace(s);if(this.shouldObfuscateNode(e)){if(-1!==v.ignoreAttrs.indexOf(t))return s;var i=e.tagName.toLowerCase(),n=e.type?e.type.toLowerCase():void 0,o=e.name?e.name.toLowerCase():void 0,a=e.id?e.id.toLowerCase():void 0;if(this.shouldReplaceInputField(n,o,a))return"option"==i?null:this.obfuscateAttributeValue(n,s,o)}}return s}obfuscateAttributeValue(e,t,s){var r=t;return e&&-1!==v.stopTypes.indexOf(e)?v.handlers[e](r):s&&-1!==s.indexOf("password")?v.handlers.password(r):!this.prefs.pr||-1===this.prefs.pr.indexOf(v.privacyType.INPUT_FIELDS)&&-1===this.prefs.pr.indexOf(v.privacyType.NO_TEXT)?this.prefs.pr&&-1!==this.prefs.pr.indexOf(v.privacyType.PRIVATE_INPUT_FIELDS)?e&&-1!==v.privateTypes.indexOf(e)?v.handlers[e](r):this.obfuscatePrivateText(t):r:v.handlers.text(r)}handleTextNode(e,t){if(t)return v.handlers.replace(e);if(this.prefs.pr){if(-1!==this.prefs.pr.indexOf(v.privacyType.NO_TEXT))return e.replace(/\S/g,".");if(-1!==this.prefs.pr.indexOf(v.privacyType.PRIVATE_FIELDS_IN_PAGE))return this.obfuscatePrivateText(e)}return e}}const f=["text","password","file","datetime","datetime-local","date","month","time","week","number","range","email","url","search","tel","color"];class w{constructor(e,t,s){this.eventHandlers={},this.preventClick=!1,this.preventClickTwice=!1,this.typeLock=0,this.enterTarget=null,this.prevTimeOut=null,this.readyTimeOut=null,this.pageLoaded=!0,this.recordEvent=e,this.obfuscator=new m(s),this.selectorGenerator=new i,this.checkUrl=t,this.addEventHandler("type","change",this.typeEventHandler),this.addEventHandler("clickAt","click",this.clickAtEventHandler,!0),this.addEventHandler("scroll","scroll",this.scrollEventHandler,!0),this.addEventHandler("checkPageLoaded","readystatechange",this.pageLoadEventHandler,!0),this.addEventHandler("select","focus",this.selectFocusEventHandler,!0),this.addEventHandler("blur","blur",this.blurFocusEventHandler,!0),this.addEventHandler("change","change",this.selectChangeEventHandler),this.addEventHandler("move","mousemove",this.mouseMovementHandler,!0),this.addEventHandler("blur","blur",this.windowBlurEventHandler,!0,!0),this.addEventHandler("focus","focus",this.windowFocusEventHandler,!0,!0),this.addEventHandler("resize","resize",this.windowResizeEventHandler,!0,!0)}attach(){if(!this.attached){this.attached=!0,this.eventListeners={};var e=this;for(let n in this.eventHandlers){var t=JSON.parse(n),s=t.eventName,r=t.capture,i=t.isWindow;function o(){var t=this.eventHandlers[n],o=function(s){for(var r=0;r<t.length;r++)t[r].call(e,s)};i?window.addEventListener(s,o,r):window.document.addEventListener(s,o,r),this.eventListeners[n]=o}o.call(this)}}}detach(){if(this.attached){this.attached=!1;for(let r in this.eventListeners){var e=JSON.parse(r),t=e.eventName,s=e.capture;e.isWindow?window.removeEventListener(t,this.eventListeners[r],s):window.document.removeEventListener(t,this.eventListeners[r],s)}delete this.eventListeners}}addEventHandler(e,t,s,r,i){s.handlerName=e;let n=JSON.stringify({eventName:t,capture:r,isWindow:i});this.eventHandlers[n]||(this.eventHandlers[n]=[]),this.eventHandlers[n].push(s)}typeEventHandler(e){if(e.target.tagName&&0==this.typeLock&&(this.typeLock=1)){var t=e.target.tagName.toLowerCase(),s=e.target.type,r=e.target.getBoundingClientRect(),i=window.scrollX,n=window.scrollY,o=r.left+i,a=r.top+n;("input"==t&&f.indexOf(s)>=0||"textarea"==t)&&(e.target.value.length>0&&window._browsee.sessionRecorder&&window._browsee.sessionRecorder.mirrorClient&&window._browsee.sessionRecorder.mirrorClient.applySimulated({added:[],characterDataChanged:[],removed:[],reordered:[],reparented:[],attributeChanged:{value:[e.target]}}),this.recordEvent("type",this.selectorGenerator.targetProperties(e.target),this.obfuscator.getObfuscatedValue(e.target),o,a,i,n))}this.typeLock=0}clickAtEventHandler(e){if(0==e.button&&!this.preventClick&&e.isTrusted){if(!this.preventClickTwice){var t=e.target.getBoundingClientRect(),s=Math.round(100*(e.clientX-t.left)/t.width),r=Math.round(100*(e.clientY-t.top)/t.height);e.target;this.recordEvent("clickAt",this.selectorGenerator.targetProperties(e.target),s+","+r,e.pageX,e.pageY,window.scrollX,window.scrollY,e),this.preventClickTwice=!0}var i=this;setTimeout((function(){i.preventClickTwice=!1}),30)}}doubleClickAtEventHandler(e){var t=e.target.getBoundingClientRect();Math.round(100*(e.pageX-t.left)/t.width),Math.round(100*(e.pageY-t.top)/t.height)}dispatchMouseMovents(){if(this.movements&&this.movements.length){var e=Object.assign({},{movements:this.movements});this.recordEvent("mouseMove",e),delete this.movements}}mouseMovementHandler(e){this.movements||(this.movements=[]);var t=(new Date).getTime();(t-this.lastMouseMovement>5||!this.lastMouseMovement)&&this.movements.push([e.clientX,e.clientY,t]),this.lastMouseMovement=t,clearTimeout(this.mouseDispatchTimeout),this.mouseDispatchTimeout=setTimeout(this.dispatchMouseMovents.bind(this),500)}scrollEventHandler(e){if(!0===this.pageLoaded){var s=this;this.currentScroll;this.scrollDetector=e.target;var r=window.scrollY;this.scrollDetector!==window.document&&(r=this.scrollDetector.scrollTop),this.currentScroll||(this.currentScroll=r),clearTimeout(this.prevTimeOut),this.prevTimeOut=setTimeout(function(){var e={start:window.innerHeight+s.currentScroll,end:window.innerHeight+r,viewHeight:window.innerHeight},i=null;this.scrollDetector!==window.document&&(i=this.selectorGenerator.targetProperties(this.scrollDetector),t()),this.recordEvent("scroll",e,i,null,null,window.scrollX,r),delete s.scrollDetector,delete s.currentScroll}.bind(s),100)}}pageLoadEventHandler(e){var t=this;"interactive"!==window.document.readyState&&"loaded"!==window.document.readyState||this.checkUrl(),"loading"===window.document.readyState?this.pageLoaded=!1:"interactive"===window.document.readyState||(this.pageLoaded=!1,clearTimeout(this.readyTimeOut),this.readyTimeOut=setTimeout(function(){t.pageLoaded=!0}.bind(t),500))}selectFocusEventHandler(e){if(e.target.nodeName){var t=e.target.nodeName.toLowerCase();if("select"==t&&e.target.multiple)for(var s=e.target.options,r=0;r<s.length;r++)null==s[r]._wasSelected&&(s[r]._wasSelected=s[r].selected);-1!==["input","select"].indexOf(t)?(this.inputFocusTarget=e.target,this.inputFocusTime=(new Date).getTime()):this.inputFocusTarget=null}}blurFocusEventHandler(e){if(e.target.nodeName&&this.inputFocusTarget&&this.inputFocusTarget==e.target){var t=(new Date).getTime()-this.inputFocusTime;this.recordEvent("input",this.selectorGenerator.targetProperties(e.target),t,e.pageX,e.pageY,window.scrollX,window.scrollY)}}windowBlurEventHandler(e){e.target.nodeName||this.recordEvent("blur")}windowFocusEventHandler(e){e.target.nodeName||this.recordEvent("focus")}windowResizeEventHandler(){var e=this;clearTimeout(this.prevResizeTimeOut),this.prevResizeTimeOut=setTimeout((function(){e.recordEvent("resize",{width:window.innerWidth,height:window.innerHeight})}),100)}getOptionLocator(e){var t=e.text.replace(/^ *(.*?) *$/,"$1");return t.match(/\xA0/)?"label=regexp:"+t.replace(/[\(\)\[\]\\\^\$\*\+\?\.\|\{\}]/g,(function(e){return"\\"+e})).replace(/\s+/g,(function(e){return e.match(/\xA0/)?e.length>1?"\\s+":"\\s":e})):"label="+t}selectChangeEventHandler(e){if(e.target.tagName&&"select"==e.target.tagName.toLowerCase())if(e.target.multiple){for(var t=e.target.options,s=0;s<t.length;s++)if(t[s]._wasSelected,t[s]._wasSelected!=t[s].selected){var r=this.getOptionLocator(t[s]);t[s].selected?this.recordEvent("addSelection",this.selectorGenerator.targetProperties(e.target),r,e.pageX,e.pageY,window.scrollX,window.scrollY):this.recordEvent("removeSelection",this.selectorGenerator.targetProperties(e.target),r,e.pageX,e.pageY,window.scrollX,window.scrollY),t[s]._wasSelected=t[s].selected}}else{var i=e.target.options[e.target.selectedIndex];this.recordEvent("select",this.selectorGenerator.targetProperties(e.target),this.getOptionLocator(i),e.pageX,e.pageY,window.scrollX,window.scrollY),window._browsee.sessionRecorder&&window._browsee.sessionRecorder.mirrorClient&&window._browsee.sessionRecorder.mirrorClient.applySimulated({added:[],characterDataChanged:[],removed:[],reordered:[],reparented:[],attributeChanged:{selected:[i]}})}}}s(279);class T{constructor(e,t,s){this.events=[],this.session=e,this.transport=t,this.trackHandler=s}sendEvents(){this.transport.socketSend({f:"events",events:this.events}),this.events=[]}addMouseEvent(e,t,s){this.events&&this.events.length>0&&this.events[this.events.length-1].type==e&&this.events[this.events.length-1].url==t?this.events[this.events.length-1].mouseData.push(s):this.events.push({type:e,url:t,etime:this.session.getEngagementTime(),pagetime:this.session.getPageTimeSpent(),stime:this.session.getSessionTimeSpent(),width:window.innerWidth,height:window.innerHeight,mouseData:[s]})}addEvent(e,t,s){this.events||(this.events=[]),e==r.EventTypes.MOUSE?this.addMouseEvent(e,t,s):this.events.push({type:e,url:t,etime:this.session.getEngagementTime(),pagetime:this.session.getPageTimeSpent(),stime:this.session.getSessionTimeSpent(),data:s}),this.nextbatch&&window.clearTimeout(this.nextbatch),this.nextbatch=window.setTimeout(this.sendEvents.bind(this),500)}}class S{generateEventId(){return Math.floor(99999999*Math.random()+1)}getStoredEvents(){var e=sessionStorage.getItem("_browsee_temp");return e?JSON.parse(e):{}}storeEvents(e){sessionStorage.setItem("_browsee_temp",JSON.stringify(e))}storeEvent(e,t){var s=this.getStoredEvents();s[e]=t,this.storeEvents(s)}deleteEvent(e){var t=this.getStoredEvents();delete t[e],this.storeEvents(t)}deleteAll(){sessionStorage.removeItem("_browsee_temp")}}const E=function(e,t,s){var i=JSON.stringify({_id:e,_identified:t,_p:s});r.isASCII(i)&&(i=btoa(i)),localStorage.setItem("_brId",i)};class b{constructor(e,t){this.init(e,t)}init(e,t){if(null!=e)return this.id=e,this.identified=!0,this.params=t||{},void E(this.id,this.identified,this.params);var s=function(){var e=localStorage.getItem("_brId");try{return"{"!==e[0]&&r.isASCII(e)?JSON.parse(atob(e)):"{"==e[0]?JSON.parse(e):null}catch(e){return null}}();s?(this.id=s._id,this.identified=s._identified,this.params=s._p):(this.id=r.guid(),this.identified=!1,this.params={},E(this.id,this.identified,this.params))}getId(){return this.id}getParams(){return this.params}isIdentified(){return this.identified}identify(e,t){if(e!=this.id||!r.objectEquals(t,this.params)){var s=this.id;return this.id=e,this.identified=!0,this.params=t,E(this.id,this.identified,this.params),s}return null}}class y{constructor(){this.reset(),this.engagementTime=0}reset(){this.start=(new Date).getTime(),this.updateEvent()}getEngagementTime(){return this.engagementTime}updateEvent(){this.start?this.engagementTime=(new Date).getTime()-this.start:this.start=(new Date).getTime(),this.eventTimer&&window.clearTimeout(this.eventTimer);var e=this;this.eventTimer=window.setTimeout((function(){e.creditEngagement()}),6e4)}creditEngagement(){this.start&&(this.engagementTime=(new Date).getTime()-this.start,this.start=null)}}const k=()=>r.generate12CharacterString(),O=(e,t)=>{var s=new Date;s.setTime(s.getTime()+N);var i="; expires="+s.toUTCString(),n=r.getRootDomain();document.cookie=e+"="+btoa(t)+i+"; domain="+n+"; path=/"},C=(e,t,s,r)=>{var i=JSON.stringify({_id:e,_t:t,_r:s,_p:r});localStorage.setItem("_browsee",i),O("_browsee",i)},_=e=>{var t=JSON.stringify({_t:e});localStorage.setItem("_browseet",t),O("_browseet",t)},N=18e5,I=e=>x(e,localStorage),L=e=>{var t=r.getCookie(e);return t?JSON.parse(atob(t)):null},x=(e,t)=>{var s=t.getItem(e);return s?JSON.parse(s):null};class R{constructor(e){this.embedded=this.checkEmbedded(),t(this.embedded),this.embedded?t():(this.initSession(),this.setSessionUrl(e))}initSession(){var e=I("_browsee"),t=I("_browseet");e||(e=L("_browsee")),t||(t=L("_browseet")),this.handleWindowId(),!e||!t||this.lastEvent&&(new Date).getTime()-this.lastEvent>N||t&&(new Date).getTime()-t._t>N?this.createNewSession():(this.sessionId=e._id,this.sessionTime=e._t,this.record=e._r,this.prefs={},void 0!==e._c&&(this.prefs.co=e._c),void 0!==e._e&&(this.prefs.et=e._e),void 0!==e._p&&(this.prefs=e._p),this.initReferrer()),window.addEventListener("beforeunload",this.onUnload.bind(this))}setSessionId(e){this.sessionId=e||k(),this.sessionTime=(new Date).getTime(),C(this.sessionId,this.sessionTime,this.record,this.prefs)}initReferrer(){var e=x("_br_ref",sessionStorage);e?(this.referrer=e.ref,this.landingPage=e.lp):this.getSessionReferrer()}getId(){return this.sessionId}getWindowId(){return this.windowId}onUnload(){sessionStorage.setItem("_brlwId",this.windowId)}handleWindowId(){var e=sessionStorage.getItem("_brlwId");e?sessionStorage.removeItem("_brlwId"):e=r.s4(),this.windowId=e}getSessionState(){return this.hasSessionState()?{rec:this.record,prefs:this.prefs}:null}hasOverride(){return void 0!==this.overrideRecord}getOverride(){return this.overrideRecord}hasSessionState(){return void 0!==this.record&&null!==this.record&&void 0===this.overrideRecord||void 0!==this.prefs&&Object.keys(this.prefs).length}setSessionState(e){this.hasOverride()?this.record=this.overrideRecord:this.record=e.rec,e.prefs?this.prefs=e.prefs:(this.prefs.et=e.et,this.prefs.co=e.co),C(this.sessionId,this.sessionTime,this.record,this.prefs)}setRecordingState(e){this.embedded||(this.record=e,C(this.sessionId,this.sessionTime,this.record,this.prefs))}setRecordingOverride(e){this.embedded||(this.overrideRecord=e,this.record=e)}getRecordingState(){return this.record}getSessionStartTime(){return this.sessionTime}getSessionTimeSpent(){return(new Date).getTime()-this.sessionTime}getPageLoadedTime(){return this.pageLoadedTime}getPageTimeSpent(){return(new Date).getTime()-this.pageLoadedTime.getTime()}getSessionUrl(){return this.sessionUrl}getEngagementTime(){return this.engagementTimer.getEngagementTime()}getReferrer(){return this.referrer}getLandingPage(){return this.landingPage}isEmbedded(){return this.embedded}createNewSession(){this.prefs={},this.record=null,this.sessionId=k(),this.sessionTime=(new Date).getTime(),C(this.sessionId,this.sessionTime),this.initReferrer()}findTopWindow(e){e||(e=window);try{return e.parent!==e&&e.parent.location&&e.parent.location.host==e.location.host?this.findTopWindow(e.parent):e}catch(t){return e}}checkEmbedded(){return this.findTopWindow()!==window}getSessionReferrer(){let e=this.findTopWindow();var t,s;this.referrer=e.document.referrer,this.landingPage=e.location.href,t=this.referrer,s=this.landingPage,sessionStorage.setItem("_br_ref",JSON.stringify({ref:t,lp:s}))}updateEvent(){return this.lastEvent&&(new Date).getTime()-this.lastEvent>N?(this.createNewSession(),this.engagementTimer.reset(),this.lastEvent=(new Date).getTime(),_(this.lastEvent),this.engagementTimer.updateEvent(),!0):(this.lastEvent=(new Date).getTime(),_(this.lastEvent),this.engagementTimer.updateEvent(),!1)}setSessionUrl(e){return this.sessionUrl&&this.sessionUrl==e?(this.updateEvent(),!1):(this.sessionUrl=e,this.pageLoadedTime=new Date,delete this.engagementTimer,this.engagementTimer=new y,this.updateEvent(),!0)}}const A=s(279).WEBSOCKET_URL+"session";class D{constructor(e,t,s,r){this.init(),this.apiKey=e,this.session=t,this.user=s,this.messageHandler=r,this.queue=[],this.mId=0}init(){this.socket||(this.socket=new WebSocket(A),this.socket.onopen=this.onOpen.bind(this),this.socket.onclose=this.onClose.bind(this),this.socket.onmessage=this.onMessage.bind(this),this.socket.onerror=this.onError.bind(this))}reset(){this.socket=new WebSocket(A),this.socket.onopen=this.onOpen.bind(this),this.socket.onclose=this.onClose.bind(this),this.socket.onmessage=this.onMessage.bind(this),this.socket.onerror=this.onError.bind(this)}socketSend(e,t){if(this.socket||this.init(),this.socket&&this.socket.readyState!==this.socket.OPEN)this.queue.push(e);else{var s={apiKey:this.apiKey,sessionId:this.session.getId(),wId:this.session.getWindowId(),record:this.session.getRecordingState(),url:this.session.getSessionUrl(),time:this.session.getSessionTimeSpent(),mId:this.mId++};t&&(s.time=t),e.session=s,this.socket.send(JSON.stringify(e))}}onOpen(){var e={f:"start",width:window.innerWidth,height:window.innerHeight,scrollX:window.scrollX,scrollY:window.scrollY,referrer:this.session.getReferrer(),landingPage:this.session.getLandingPage(),user:this.user.getId(),identified:this.user.isIdentified(),userParams:this.user.getParams()};if(this.socketSend(e),this.queue.length>0){for(var t=0;t<this.queue.length;t++)this.socketSend(this.queue[t]);this.queue=[]}}onMessage(e){try{var s=JSON.parse(e.data);this.messageHandler&&this.messageHandler(s)}catch(s){t(e.data)}}onClose(){this.socket=void 0}onError(e){t()}}const U=e=>{var t=e.url,s=e.method||"POST",r=e.dataType||"application/json",i=e.withCredentials||!0,n=e.success,o=e.data||null,a=e.headers,c=new XMLHttpRequest;for(var d in c.open(s,t,!0),c.setRequestHeader("content-type",r),a)c.setRequestHeader(d,a[d]);c.withCredentials=i,c.onreadystatechange=function(){n&&4==this.readyState&&200==this.status&&n(this.responseText)},o?c.send(o):c.send()};var P=window._browsee||[];const H=()=>{var e=window.XMLHttpRequest.prototype.open;window.XMLHttpRequest.prototype.open=function(){this._brrequestId=Math.floor(99999999*Math.random()+1);const t=[].slice.call(arguments);return this._method=t[0],this._url=t[1],e.apply(this,t)};var t=window.XMLHttpRequest.prototype.send;window.XMLHttpRequest.prototype.send=function(){var e=this.onreadystatechange,s=function(){e&&e.apply(this,[].slice.call(arguments)),4==this.readyState&&P.trackResponse(this._brrequestId,this.status,this._url)};e?this.onreadystatechange=s:this.addEventListener("readystatechange",s);var r=t.apply(this,[].slice.call(arguments));return P.trackSend(this._brrequestId,this._method,this._url),r}};var M={navigationMetrics:["startTime","domInteractive","domComplete","requestStart","responseEnd"],getLoadNumbers:function(){var e={};if("performance"in window){var t=performance.getEntriesByType("navigation");t&&t.length&&M.navigationMetrics.forEach((s=>{e[s]=Math.floor(t[0][s])}));var s=performance.getEntriesByType("paint");s&&s.length&&(e.firstPaint=Math.floor(s[0].startTime))}return e},getGaExperiment:function(){try{if(gaData&&Object.keys(gaData)&&Object.keys(gaData).length){var e=Object.keys(gaData)[0];if(gaData[e]&&gaData[e].experiments&&Object.keys(gaData[e].experiments).length){var t=Object.keys(gaData[e].experiments)[0];return t+"-"+gaData[e].experiments[t]}}}catch(e){}return null}};const q=s(279);var Y=window._browsee||function(){(Y.q=Y.q||[]).push(arguments)};Y.pUrl=function(){let e=document.location.pathname;return e&&e.length>1&&"/"==e.charAt(e.length-1)&&(e=e.substr(0,e.length-1)),e},Y.checkUrl=function(){if(Y.session&&Y.recorder&&Y.session.setSessionUrl(document.location.href)){Y.recorder.addEvent(r.EventTypes.URL,Y.pUrl(),{scroll:window.innerHeight+window.scrollY,scrollY:window.scrollY,fullUrl:document.location.href});var e=new Event("br_page_change");window.dispatchEvent(e)}},Y.checkUrlAndAddEvent=function(e,t,s){Y.checkUrl(),Y.recorder&&Y.recorder.addEvent(e,t,s),Y.checkUrlEvent&&clearTimeout(Y.checkUrlEvent),Y.checkUrlEvent=setTimeout(Y.checkUrl,200)},Y.trackSend=function(e,t,s){const i=(new Date).getTime();Y.requests||(Y.requests={}),s&&s.split&&-1==s.indexOf(q.API_URL)&&!Y.requests[e]&&window.document.hasFocus()&&(Y.requests[e]={start:i,method:t,url:s.split("?")[0]},Y.checkUrlAndAddEvent(r.EventTypes.NETWORK_CALL,Y.pUrl(),Y.requests[e]),Y.clickTracker&&Y.clickTracker.updateNetworkCall(Y.requests[e]))},Y.trackResponse=function(e,t,s){const r=(new Date).getTime();var i;Y.requests&&Y.requests[e]&&window.document.hasFocus()&&((i=Object.assign?Object.assign({},Y.requests[e]):JSON.parse(JSON.stringify(Y.requests[e]))).statusCode=t,i.time=r-i.start,i.stime=Y.session.getSessionTimeSpent(),delete i.start,Y.checkUrlAndAddEvent(1,Y.pUrl(),i),delete Y.requests[e])},Y.recordEvent=function(e,s,i,n,o,a,c,d){Y.session&&(Y.session.updateEvent()&&Y.getSessionState());const l=Y.session.getPageTimeSpent(),h=Y.session.getSessionTimeSpent(),g=Y.session.getSessionStartTime(),p=Y.pUrl();var v;if(Y.recorder&&"mouseMove"==e)return s.movements&&(s.movements.forEach((e=>{e[2]-=g})),v=s.movements),void Y.recorder.addEvent(r.EventTypes.MOUSE,p,{x:n,y:o,scrollX:a,scrollY:c,time:l,stime:h,movements:v});t();var m={url:p,type:e,properties:s,time:l,stime:h,wId:Y.session.getWindowId(),target:i,x:n,y:o,scrollX:a,scrollY:c};if("clickAt"==e||"doubleClickAt"==e){var f=null;Y.eventStore&&(f=Y.eventStore.generateEventId(),Y.eventStore.storeEvent(f,JSON.stringify(m))),Y.clickTracker.updateClick({event:d,x:n,y:o,scrollX:a,scrollY:c,time:h},"doubleClickAt"==e,(function(e,s){Y.eventStore&&Y.eventStore.deleteEvent(f),e==u&&t();var i=m,n=i.url;delete i.url,delete i.wId,i.changes=s,i.position=i.target,delete i.target,Y.checkUrlAndAddEvent(r.EventTypes.EVENT,n,i)}))}else{var w=m;delete w.url,delete w.wId,"input"==e&&(w.inputtime=w.target,delete w.target),Y.checkUrlAndAddEvent(r.EventTypes.EVENT,p,w)}},Y.sendStoredEvents=function(){if(Y.eventStore){var e=Y.eventStore.getStoredEvents();for(var t in e)if(e.hasOwnProperty(t)){var s=JSON.parse(e[t]),i=s.url;s.wId==Y.session.getWindowId()&&(s.position=s.target,delete s.target,delete s.url,delete s.wId,n=s,Y.checkUrlAndAddEvent(r.EventTypes.EVENT,i,n))}Y.eventStore.deleteAll()}var n},Y.sendClickData=function(e,t,s,i,n){var o={type:e,url:i,properties:s,wId:Y.session.getWindowId(),time:n,coords:t};Y.checkUrlAndAddEvent(r.EventTypes.CLICK_EVENT,i,o)},Y.handleSocketResponse=function(t){t.record&&(Y.session.setRecordingState(t.record),t.record==e.RecordingStates.ALL&&Y.load("replay.min.js","Recorder Loaded"))},Y.handleTrackResponse=function(e){var t=JSON.parse(e);t.elements&&t.elements.length},Y.findOffset=function(e,t){var s=e.getBoundingClientRect(),r={x:0,y:0};return t.x&&t.y&&(r.x=t.x-s.x,r.y=t.y-s.y),r},Y.sendPageLoad=function(){if(Y.pageLoad&&Y.recorder){var e=Y.pageLoad;return void Y.recorder.addEvent(r.EventTypes.PAGE_LOAD,e.url,{scroll:e.scroll,scrollY:window.scrollY,experiment:e.experiment,performance:e.performance})}const t=Y.pUrl(),s=window.innerHeight+window.scrollY,i=M.getLoadNumbers(),n=M.getGaExperiment();Y.recorder?Y.recorder.addEvent(r.EventTypes.PAGE_LOAD,t,{scroll:s,experiment:n,performance:i}):Y.pageLoad={url:t,scroll:s,experiment:n,performance:i}},Y.onPageLoad=function(){"complete"===document.readyState?Y.sendPageLoad():document.addEventListener("readystatechange",(function(e){"complete"===e.target.readyState&&Y.sendPageLoad()}))},Y.getSessionState=function(){Y.user=Y.user||new b;var e=q.API_URL+"sessionstate?_a="+Y.apiKey+"&_u="+Y.user.getId()+"&_d="+(r.isDnt()?"1":"0")+"&_l="+encodeURIComponent(Y.pUrl());Y.session.hasOverride()&&(e+="&_o="+Y.session.getOverride()),U({url:e,method:"GET",dataType:"text/plain",withCredentials:!1,success:function(e){if(e){var t=JSON.parse(e);Y.session.setSessionState(t),Y.setSession(Y.session.getSessionState()),t&&t.prefs&&t.prefs.it&&t.prefs.it.length&&Y.load("integrations.min.js","Integrations Loaded")}}})},Y.setTestParams=function(){if(document.location.search&&URLSearchParams){var t=new URLSearchParams(document.location.search);t.has(r.BrowseeUrlParams.RECORD)&&Y.session?Y.session.setRecordingState(e.RecordingStates.ALL):t.has(r.BrowseeUrlParams.TEST_INSTALLATION)&&r.testInstallation(Y.getRecordingUrl())}},Y.setRecording=function(t){Y.session=new R(document.location.href),Y.session.setRecordingOverride(t?e.RecordingStates.ALL:e.RecordingStates.NONE)},Y.resetSession=function(e){Y.session=new R(document.location.href),Y.session.setSessionId(e)},Y.onLoad=function(){if(Y.loaded)t();else if(Y.session||(this.url=document.location.href,Y.session=new R(this.url),!Y.session.isEmbedded())){Y.setTestParams(),Y.onPageLoad();var e=Y.session.getSessionState();e?Y.setSession(e):Y.getSessionState(),Y.loaded=!0}else Y.loaded=!0},Y.load=function(e,s){!function(e,t,s){var r=document.createElement("script");if(r.src=e,r.onload=s,r.onreadystatechange=s,t)t.appendChild(r);else{var i=document.getElementsByTagName("script")[0];i.parentNode.insertBefore(r,i)}}(q.CDN_URL+q.JS_PATH+e,document.body,(function(){t()}))},Y.setSession=function(s){if(void 0!==s.rec&&null!==s.rec){var i=s.rec;t(s.rec),i!==e.RecordingStates.NONE&&(Y.user=Y.user||new b,Y.transport=new D(Y.apiKey,Y.session,Y.user,Y.handleSocketResponse),Y.eventTracker=new w(Y.recordEvent,Y.checkUrl,Y.session.getSessionState().prefs),Y.eventTracker.attach(),delete Y.clickTracker,Y.clickTracker=new p(Y.sendClickData),Y.recorder=new T(Y.session,Y.transport,Y.handleTrackResponse),Y.eventStore=new S,Y.sendStoredEvents(),Y.recorder.addEvent(r.EventTypes.URL,Y.pUrl(),{scroll:window.innerHeight+window.scrollY,scrollY:window.scrollY,fullUrl:document.location.href}),Y.pageLoad&&Y.sendPageLoad(),H(),(n=window.fetch)&&(window.fetch=function(){var e=[].slice.call(arguments);const t=e[1]?e[1].method:"GET",s=e[0];return new Promise((function(r,i){var o=Math.floor(99999999*Math.random()+1);n.apply(window,e).then((function(e){r(e),P.trackResponse(o,e.status)})).catch((function(e){i(e),P.trackResponse(o,e.status)})),P.trackSend(o,t,s)}))}),i!==e.RecordingStates.NO_DOM&&(Y.resetSessionRecorder?Y.resetSessionRecorder():Y.load("replay.min.js","Recorder Loaded")),(s.prefs.et||null==s.prefs.et)&&(Y.setErrorTracker?Y.setErrorTracker():Y.load("raven.min.js","Raven Loaded")))}var n;s.prefs.co&&Y.load("components.min.js","Components Loaded"),Y.replaceQueue();var o=new Event("br_session_init");window.dispatchEvent(o)},Y.init=function(e){Y.apiKey=e},Y.logEvent=function(e,t){if(!(null==e||"string"!=typeof e||e.length>250))return Y.recorder&&Y.recorder.addEvent(r.EventTypes.CUSTOM_EVENT,Y.pUrl(),{text:e,params:t}),!0;console.log("%c Event names must be valid text","color: red; font-weight: bold;")},Y.identify=function(e,t){if(null!=e&&"string"==typeof e){if(Y.user){var s=Y.user.identify(e,t);s&&Y.recorder&&Y.recorder.addEvent(r.EventTypes.IDENTIFY,Y.pUrl(),{id:e,params:t,anonymousId:s})}else Y.user=new b(e,t);return!0}console.log("%c Invalid ID provided to identify call","color: red; font-weight: bold;")},Y.getRecordingUrl=function(t){var s="";Y.session&&(Y.session.getRecordingState()==e.RecordingStates.ALL&&(s="https://browsee.io/app/session/"+Y.session.getId()));return t&&t(s),s},Y.getSessionUrl=function(e){var t="https://browsee.io/app/session/";return Y.session&&(t+=Y.session.getId()),e&&e(t),t},Y.applyMethod=function(e){var t=[].slice.call(e),s=t.shift();if(Y[s])try{Y[s].apply(null,t)}catch(e){console.error(e)}},Y.processQueue=function(){for(var e=Y.q.length,t=0;t<e;t++)Y.applyMethod(Y.q.shift())},Y.replaceQueue=function(){Y.q.length&&Y.processQueue(),Y.q.push=function(e){Y.applyMethod(e)}},t(),Y.q&&(Y.processQueue(),Y.onLoad())})()})();